/**
 * @name string-strip-html
 * @fileoverview Strip HTML tags from strings. No parser, accepts mixed sources.
 * @version 11.6.1
 * @author Roy Revelt, Codsen Ltd
 * @license MIT
 * {@link https://codsen.com/os/string-strip-html/}
 */

import te from"lodash.isplainobject";import le from"lodash.trim";import $e from"lodash.without";import{decode as se}from"html-entities";import{rApply as me}from"ranges-apply";import{Ranges as ce}from"ranges-push";import{right as y}from"string-left-right";function X(t){return/[-_A-Za-z0-9]/.test(t)}function _(t,m){if(!t)return[];if(Array.isArray(t))return t.filter(D=>typeof D=="string"&&D.trim());if(typeof t=="string")return t.trim()?[t]:[];throw new TypeError(`string-strip-html/stripHtml(): [THROW_ID_05] ${m} must be array containing zero or more strings or something falsey. Currently it's equal to: ${t}, that a type of ${typeof t}.`)}function ue(t,m,D,c){for(let f=m,b=t.length;f<b;f++){if(t.startsWith(D,f))return!0;if(t.startsWith(c,f))return!1}return!1}function G(t,m,D){return!t||!t.quotes||!ue(m,D+1,t.quotes.value,">")}var W=new Set(["!doctype","abbr","address","area","article","aside","audio","base","bdi","bdo","blockquote","body","br","button","canvas","caption","cite","code","col","colgroup","data","datalist","dd","del","details","dfn","dialog","div","dl","doctype","dt","em","embed","fieldset","figcaption","figure","footer","form","h1","h2","h3","h4","h5","h6","head","header","hgroup","hr","html","iframe","img","input","ins","kbd","keygen","label","legend","li","link","main","map","mark","math","menu","menuitem","meta","meter","nav","noscript","object","ol","optgroup","option","output","param","picture","pre","progress","rb","rp","rt","rtc","ruby","samp","script","section","select","slot","small","source","span","strong","style","sub","summary","sup","svg","table","tbody","td","template","textarea","tfoot","th","thead","time","title","tr","track","ul","var","video","wbr","xml"]),j=new Set(["a","b","i","p","q","s","u"]),q=new Set([".",",",";","!","?"]),Y=new Set([".",",","?",";",")","\u2026",'"',"\xBB"]),ee=new Set(["a","abbr","acronym","audio","b","bdi","bdo","big","button","canvas","cite","code","data","datalist","del","dfn","em","embed","i","iframe","input","ins","kbd","label","map","mark","meter","noscript","object","output","picture","progress","q","ruby","s","samp","select","slot","small","span","strong","sub","sup","svg","template","textarea","time","u","tt","var","video","wbr"]);var ne="11.6.1";var Ne=ne,oe={ignoreTags:[],ignoreTagsWithTheirContents:[],onlyStripTags:[],stripTogetherWithTheirContents:["script","style","xml"],skipHtmlDecoding:!1,trimOnlySpaces:!1,stripRecognisedHTMLOnly:!1,dumpLinkHrefsNearby:{enabled:!1,putOnNewLine:!1,wrapHeads:"",wrapTails:""},cb:null,reportProgressFunc:null,reportProgressFuncFrom:0,reportProgressFuncTo:100};function be(t,m){let D=Date.now(),c=[],f=[],b=[],$=[],n={};function ae(){n={attributes:[]}}ae();let V=null,w=null,N=null,I=!1,o={},d={tagName:"",hrefValue:"",openingTagEnds:void 0},E="",R=!1,B=null,F=!0;function H(e,l,a){if(Array.isArray(l.stripTogetherWithTheirContents)&&(l.stripTogetherWithTheirContents.includes(n.name)||l.stripTogetherWithTheirContents.includes("*")))if(n.slashPresent&&Array.isArray(c)&&c.some(r=>r.name===n.name)){for(let r=c.length;r--;)if(c[r].name===n.name){$=$.filter(([u,p])=>(u<c[r].lastOpeningBracketAt||u>=e+1)&&(p<=c[r].lastOpeningBracketAt||p>e+1));let g=e+1;n.lastClosingBracketAt&&(g=n.lastClosingBracketAt+1),$.push([c[r].lastOpeningBracketAt,g]),Y.has(t[e])&&l.cb?l.cb({tag:n,deleteFrom:c[r].lastOpeningBracketAt,deleteTo:e+1,insert:null,rangesArr:a,proposedReturn:[c[r].lastOpeningBracketAt,e,null]}):l.cb&&l.cb({tag:n,deleteFrom:c[r].lastOpeningBracketAt,deleteTo:e,insert:"",rangesArr:a,proposedReturn:[c[r].lastOpeningBracketAt,e,""]}),c.splice(r,1);break}}else n.slashPresent||c.push(n);else Array.isArray(l.ignoreTagsWithTheirContents)&&U(e,l,n)&&(F=!1)}function L(e,l,a,r,g,u){if(Array.isArray(i.current())&&typeof a=="number"&&i.current()[0][0]===0&&i.current()[0][1]>=a)return"";if(t.length===r&&u&&(!s.dumpLinkHrefsNearby||!s.dumpLinkHrefsNearby?.enabled))return null;let p="";if(Number.isInteger(a)&&a<g&&(p+=e.slice(a,g)),Number.isInteger(r)&&r>u+1){let S=e.slice(u+1,r);r&&!y(t,r-1)&&(S=S.trimEnd()),S.includes(`
`)&&T(r,e)?p+=" ":p+=S}let P=!Y.has(e[l]),Q=e[r-1]!==">"||!e[a].trim(),Z=!['"',"("].includes(e[g-1]),ie=![";",".",":","!"].includes(e[l]);if((P||Q&&Z&&ie)&&(Q||Z)&&e[l]!=="!"&&(!ee.has(n.name)||typeof a=="number"&&a<g||typeof r=="number"&&r>u+1)){let S=p.match(/\n/g);return Array.isArray(S)&&S.length?S.length===1?`
`:S.length===2?`

`:`


`:" "}return""}function x(e,l){if(e.dumpLinkHrefsNearby?.enabled&&d.tagName&&d.tagName===n.name&&n.lastOpeningBracketAt&&(d.openingTagEnds&&n.lastOpeningBracketAt>d.openingTagEnds||!d.openingTagEnds)&&(R=!0),R){let a=e.dumpLinkHrefsNearby?.putOnNewLine?`

`:"";E=`${a}${d.hrefValue}`,(typeof l!="number"||y(t,l-1))&&(E+=a)}}function T(e,l){return l?l[e]==="<"&&l[e+1]!=="%":t[e]==="<"&&t[e+1]!=="%"}function A(e){return t[e]===">"&&t[e-1]!=="%"}function U(e,l,a){if(l.ignoreTagsWithTheirContents.includes("*"))return!0;let r=t.indexOf(`<${a.name}`,e),g=t.indexOf(`</${a.name}`,e);return!a.slashPresent&&g===-1||a.slashPresent&&!f.some(u=>u.name===a.name)||g>-1&&r>-1&&r<g?!1:l.ignoreTagsWithTheirContents.includes(a.name)}if(typeof t!="string")throw new TypeError(`string-strip-html/stripHtml(): [THROW_ID_01] Input must be string! Currently it's: ${(typeof t).toLowerCase()}, equal to:
${JSON.stringify(t,null,4)}`);if(m)if(te(m)){if(m.reportProgressFunc&&typeof m.reportProgressFunc!="function")throw new Error(`string-strip-html/stripHtml(): [THROW_ID_03] the opts.reportProgressFunc, callback function, should be a function but it was given as type ${typeof m.reportProgressFunc}, equal to ${JSON.stringify(m.reportProgressFunc,null,4)}`);if(typeof m.dumpLinkHrefsNearby=="boolean"&&m.dumpLinkHrefsNearby!=null)throw new Error(`string-strip-html/stripHtml(): [THROW_ID_04] the opts.dumpLinkHrefsNearby should be a plain object but it was given as type ${typeof m.dumpLinkHrefsNearby}, equal to ${JSON.stringify(m.dumpLinkHrefsNearby,null,4)}`)}else throw new TypeError(`string-strip-html/stripHtml(): [THROW_ID_02] Optional Options Object must be a plain object! Currently it's: ${(typeof m).toLowerCase()}, equal to:
${JSON.stringify(m,null,4)}`);function M(){R&&(d={tagName:"",hrefValue:"",openingTagEnds:void 0},R=!1)}let s={...oe,...m,dumpLinkHrefsNearby:{...oe.dumpLinkHrefsNearby,...m?.dumpLinkHrefsNearby}};if(Object.prototype.hasOwnProperty.call(s,"returnRangesOnly"))throw new TypeError("string-strip-html/stripHtml(): [THROW_ID_05] resolvedOpts.returnRangesOnly has been removed from the API since v.5 release.");if(s.reportProgressFuncFrom&&typeof s.reportProgressFuncFrom!="number")throw new Error(`string-strip-html/stripHtml(): [THROW_ID_06] the resolvedOpts.reportProgressFuncFrom, callback function's "from" range, should be a number but it was given as type ${typeof s.reportProgressFuncFrom}, equal to ${JSON.stringify(s.reportProgressFuncFrom,null,4)}`);if(s.reportProgressFuncTo&&typeof s.reportProgressFuncTo!="number")throw new Error(`string-strip-html/stripHtml(): [THROW_ID_07] the resolvedOpts.reportProgressFuncTo, callback function's "to" range, should be a number but it was given as type ${typeof s.reportProgressFuncTo}, equal to ${JSON.stringify(s.reportProgressFuncTo,null,4)}`);s.ignoreTags=_(s.ignoreTags,"resolvedOpts.ignoreTags"),s.onlyStripTags=_(s.onlyStripTags,"resolvedOpts.onlyStripTags");let z=!!s.onlyStripTags.length;s.onlyStripTags.length&&s.ignoreTags.length&&(s.onlyStripTags=$e(s.onlyStripTags,...s.ignoreTags)),s.stripTogetherWithTheirContents?typeof s.stripTogetherWithTheirContents=="string"&&s.stripTogetherWithTheirContents.length&&(s.stripTogetherWithTheirContents=[s.stripTogetherWithTheirContents]):s.stripTogetherWithTheirContents=[];let J={};if(s.stripTogetherWithTheirContents&&Array.isArray(s.stripTogetherWithTheirContents)&&s.stripTogetherWithTheirContents.length&&!s.stripTogetherWithTheirContents.every((e,l)=>typeof e!="string"?(J.el=e,J.i=l,!1):!0))throw new TypeError(`string-strip-html/stripHtml(): [THROW_ID_08] Optional Options Object's key stripTogetherWithTheirContents was set to contain not just string elements! For example, element at index ${J.i} has a value ${J.el} which is not string but ${(typeof J.el).toLowerCase()}.`);s.cb||(s.cb=({rangesArr:e,proposedReturn:l})=>{l&&e.push(...l)});let i=new ce({limitToBeAddedWhitespace:!0,limitLinebreaksCount:2});if(!s.skipHtmlDecoding)for(;t!==se(t,{scope:"strict"});)t=se(t,{scope:"strict"});let C=!1,k=!1,v=0,K=0,h=t.length,re=Math.floor(h/2);for(let e=0;e<h;e++){if(s.reportProgressFunc&&(h>1e3&&h<2e3?e===re&&s.reportProgressFunc(Math.floor((s.reportProgressFuncTo-s.reportProgressFuncFrom)/2)):h>=2e3&&(v=s.reportProgressFuncFrom+Math.floor(e/h*(s.reportProgressFuncTo-s.reportProgressFuncFrom)),v!==K&&(K=v,s.reportProgressFunc(v)))),Object.keys(n).length>1&&n.lastClosingBracketAt&&n.lastClosingBracketAt<e&&t[e]!==" "&&B===null&&(B=e),!C&&t[e]==="%"&&t[e-1]==="{"&&t.includes("%}",e+1)){N=null;let l=t.indexOf("%}",e)-1;if(l>e){e=l;continue}}if(!C&&A(e)&&(!n||Object.keys(n).length<2)&&e>1){for(let l=e;l--;)if(t[l-1]===void 0||A(l)){let a=t[l-1]===void 0?l:l+1,r=t.slice(a,e+1);if(t!==`<${le(r.trim(),"/>")}>`&&[...W].some(g=>le(r.trim().split(/\s+/).filter(u=>u.trim()).filter((u,p)=>p===0),"/>").toLowerCase()===g)&&be(`<${r.trim()}>`,s).result===""){(!b.length||b[b.length-1][0]!==n.lastOpeningBracketAt)&&b.push([a,e+1]),(!$.length||$[$.length-1][0]!==n.lastOpeningBracketAt)&&$.push([a,e+1]);let g=L(t,e,a,e+1,a,e+1),u=e+1;if(t[u]&&!t[u].trim()){for(let p=u;p<h;p++)if(t[p].trim()){u=p;break}}s.cb({tag:n,deleteFrom:a,deleteTo:u,insert:g,rangesArr:i,proposedReturn:[a,u,g]})}break}}if(!k&&t[e]==="/"&&!n.quotes?.value&&Number.isInteger(n.lastOpeningBracketAt)&&!Number.isInteger(n.lastClosingBracketAt)&&(n.slashPresent=e),t[e]==='"'||t[e]==="'")if(!k&&n.nameStarts&&n.quotes&&n.quotes.value&&n.quotes.value===t[e]){o.valueEnds=e,o.value=t.slice(o.valueStarts,e),n.attributes.push(o),o={},delete n.quotes;let l;s.dumpLinkHrefsNearby?.enabled&&n.attributes.some(a=>{if(typeof a.name=="string"&&a.name.toLowerCase()==="href")return l=`${s.dumpLinkHrefsNearby?.wrapHeads||""}${a.value}${s.dumpLinkHrefsNearby?.wrapTails||""}`,!0})&&(d={tagName:n.name,hrefValue:l,openingTagEnds:void 0})}else!k&&!n.quotes&&n.nameStarts&&(n.quotes={},n.quotes.value=t[e],n.quotes.start=e,o.nameStarts&&o.nameEnds&&o.nameEnds<e&&o.nameStarts<e&&!o.valueStarts&&(o.name=t.slice(o.nameStarts,o.nameEnds)));if(n.nameStarts!==void 0&&n.nameEnds===void 0&&(!t[e].trim()||!X(t[e]))){if(n.nameEnds=e,n.name=t.slice(n.nameStarts,n.nameEnds+(!A(e)&&t[e]!=="/"&&t[e+1]===void 0?1:0)),t[n.nameStarts-1]!=="!"&&!n.name.replace(/-/g,"").length||/^\d+$/.test(n.name[0])){n={};continue}if(typeof n.name=="string"&&n.name.toLowerCase()==="doctype"&&(k=!0),T(e)){x(s);let l=L(t,e,n.leftOuterWhitespace,e,n.lastOpeningBracketAt,e);(s.stripTogetherWithTheirContents.includes(n.name)||s.stripTogetherWithTheirContents.includes("*"))&&($=$.filter(([a,r])=>!(a===n.leftOuterWhitespace&&r===e))),s.cb({tag:n,deleteFrom:n.leftOuterWhitespace,deleteTo:e,insert:`${l}${E}${l}`,rangesArr:i,proposedReturn:[n.leftOuterWhitespace,e,`${l}${E}${l}`]}),M(),H(e,s,i)}}if(n.quotes?.start&&n.quotes.start<e&&!n.quotes.end&&o.nameEnds&&o.equalsAt&&!o.valueStarts&&(o.valueStarts=e),!n.quotes&&o.nameEnds&&t[e]==="="&&!o.valueStarts&&!o.equalsAt&&(o.equalsAt=e),!n.quotes&&o.nameStarts&&o.nameEnds&&!o.valueStarts&&t[e].trim()&&t[e]!=="="&&(n.attributes.push(o),o={}),!n.quotes&&o.nameStarts&&!o.nameEnds&&(k&&`'"`.includes(t[o.nameStarts])?o.nameStarts<e&&t[e]===t[o.nameStarts]&&(o.nameEnds=e+1,o.name=t.slice(o.nameStarts,o.nameEnds)):t[e].trim()?t[e]==="="?o.equalsAt||(o.nameEnds=e,o.equalsAt=e,o.name=t.slice(o.nameStarts,o.nameEnds)):t[e]==="/"||A(e)?(o.nameEnds=e,o.name=t.slice(o.nameStarts,o.nameEnds),n.attributes.push(o),o={}):T(e)&&(o.nameEnds=e,o.name=t.slice(o.nameStarts,o.nameEnds),n.attributes.push(o),o={}):(o.nameEnds=e,o.name=t.slice(o.nameStarts,o.nameEnds))),!n.quotes&&n.nameEnds<e&&!t[e-1].trim()&&t[e].trim()&&!"<>/!".includes(t[e])&&!o.nameStarts&&!n.lastClosingBracketAt&&(o.nameStarts=e),n.lastOpeningBracketAt!==null&&n.lastOpeningBracketAt<e&&t[e]==="/"&&n.onlyPlausible&&(n.onlyPlausible=!1),n.lastOpeningBracketAt!==null&&n.lastOpeningBracketAt<e&&t[e]!=="/"&&(n.onlyPlausible===void 0&&((!t[e].trim()||T(e))&&!n.slashPresent?n.onlyPlausible=!0:n.onlyPlausible=!1),t[e].trim()&&n.nameStarts===void 0&&!T(e)&&t[e]!=="/"&&!A(e)&&t[e]!=="!"&&(n.nameStarts=e,n.nameContainsLetters=!1)),n.nameStarts&&!n.quotes&&typeof t[e]=="string"&&t[e].toLowerCase()!==t[e].toUpperCase()&&(n.nameContainsLetters=!0),A(e)&&G(n,t,e)&&!0&&n.lastOpeningBracketAt!==void 0&&(n.lastClosingBracketAt=e,B=null,Object.keys(o).length&&(n.attributes.push(o),o={}),s.dumpLinkHrefsNearby?.enabled&&d.tagName&&!d.openingTagEnds&&(d.openingTagEnds=e)),(!k||t[e]===">")&&n.lastOpeningBracketAt!==void 0){if(n.lastClosingBracketAt===void 0){if(n.lastOpeningBracketAt<e&&!T(e)&&(t[e+1]===void 0||T(e+1))&&n.nameContainsLetters&&typeof n.nameStarts=="number"){if(n.name=t.slice(n.nameStarts,n.nameEnds||e+1).toLowerCase(),(!b.length||b[b.length-1][0]!==n.lastOpeningBracketAt)&&b.push([n.lastOpeningBracketAt,e+1]),s.ignoreTags.includes(n.name)||U(e,s,n)||!W.has(n.name)&&(n.onlyPlausible||s.stripRecognisedHTMLOnly)){n={},o={};continue}if((W.has(n.name)||j.has(n.name))&&(n.onlyPlausible===!1||n.onlyPlausible===!0&&n.attributes.length)||t[e+1]===void 0){x(s);let l=L(t,e,n.leftOuterWhitespace,e+1,n.lastOpeningBracketAt,n.lastClosingBracketAt);C&&n.name==="script"&&n.slashPresent&&(C=!1);let a;l===null||E===null?a=null:a=`${l}${E}${l}`,s.cb({tag:n,deleteFrom:n.leftOuterWhitespace,deleteTo:e+1,insert:a,rangesArr:i,proposedReturn:[n.leftOuterWhitespace,e+1,a]}),M(),H(e,s,i)}if(!$.length||$[$.length-1][0]!==n.lastOpeningBracketAt&&$[$.length-1][1]!==e+1)if(s.stripTogetherWithTheirContents.includes(n.name)||s.stripTogetherWithTheirContents.includes("*")){let l;for(let a=c.length;a--;)c[a].name===n.name&&(l=c[a]);l?($=$.filter(([a])=>a!==l.lastOpeningBracketAt),$.push([l.lastOpeningBracketAt,e+1])):$.push([n.lastOpeningBracketAt,e+1])}else $.push([n.lastOpeningBracketAt,e+1])}}else if(e>n.lastClosingBracketAt&&t[e].trim()||t[e+1]===void 0){let l=n.lastClosingBracketAt===e?e+1:e;s.trimOnlySpaces&&l===h-1&&B!==null&&B<e&&(l=B),(!b.length||b[b.length-1][0]!==n.lastOpeningBracketAt)&&b.push([n.lastOpeningBracketAt,n.lastClosingBracketAt+1]);let a=s.ignoreTags.includes(n.name),r=U(e,s,n);if(!F||s.stripRecognisedHTMLOnly&&typeof n.name=="string"&&!W.has(n.name.toLowerCase())&&!j.has(n.name.toLowerCase())||!z&&(a||r)||z&&!s.onlyStripTags.includes(n.name)){if(r)if(n.slashPresent){for(let g=f.length;g--;)if(f[g].name===n.name){f.splice(g,1);break}f.length||(F=!0)}else F&&(F=!1),f.push(n);s.cb({tag:n,deleteFrom:null,deleteTo:null,insert:null,rangesArr:i,proposedReturn:null}),n={},o={}}else if(!n.onlyPlausible||n.attributes.length===0&&n.name&&(W.has(n.name.toLowerCase())||j.has(n.name.toLowerCase()))||n.attributes?.some(g=>g.equalsAt)){(!$.length||$[$.length-1][0]!==n.lastOpeningBracketAt)&&$.push([n.lastOpeningBracketAt,n.lastClosingBracketAt+1]);let g=L(t,e,n.leftOuterWhitespace,l,n.lastOpeningBracketAt,n.lastClosingBracketAt);E="",R=!1,x(s,l);let u;typeof E=="string"&&E.length?(u=`${g}${E}${g===`

`?`
`:g}`,l===n.lastClosingBracketAt+1&&(!t[l]||!q.has(t[l]))&&(u+=" "),n.leftOuterWhitespace===n.lastOpeningBracketAt&&i.last()&&i.last()[1]<n.lastOpeningBracketAt&&(!s.dumpLinkHrefsNearby||!s.dumpLinkHrefsNearby?.putOnNewLine||!q.has(t[l]))&&(u=" "+u)):u=g,u!==null&&(n.leftOuterWhitespace===0||!y(t,l-1))&&!s.dumpLinkHrefsNearby?.enabled&&(u=void 0);let p=0;if(R&&q.has(t[l])){console.log("2433"),s.dumpLinkHrefsNearby?.putOnNewLine&&(console.log(`2436 bring ${t[l]} forward from index ${l} to ${n.leftOuterWhitespace}`),u=`${t[l]}${u||""}`);let P=y(t,l);P&&u?.endsWith(`
`)?p+=P-e:(!P||P>e)&&p++}s.cb({tag:n,deleteFrom:n.leftOuterWhitespace,deleteTo:l+p,insert:u,rangesArr:i,proposedReturn:[n.leftOuterWhitespace,l+p,u]}),M(),H(e,s,i)}else n={};A(e)||(n={})}k&&(k=!1)}if((!C||t[e]==="<"&&y(t,y(t,e))&&t[y(t,e)]==="/"&&t.startsWith("script",y(t,y(t,e))))&&T(e)&&!T(e-1)&&!`'"`.includes(t[e+1])&&(!`'"`.includes(t[e+2])||/\w/.test(t[e+1]))&&!(t[e+1]==="c"&&t[e+2]===":")&&!(t[e+1]==="f"&&t[e+2]==="m"&&t[e+3]==="t"&&t[e+4]===":")&&!(t[e+1]==="s"&&t[e+2]==="q"&&t[e+3]==="l"&&t[e+4]===":")&&!(t[e+1]==="x"&&t[e+2]===":")&&!(t[e+1]==="f"&&t[e+2]==="n"&&t[e+3]===":")&&G(n,t,e)){if(A(y(t,e)))continue;if(n.nameEnds&&n.nameEnds<e&&!n.lastClosingBracketAt&&(n.onlyPlausible===!0&&n.attributes&&n.attributes.length||n.onlyPlausible===!1)){let l=L(t,e,n.leftOuterWhitespace,e,n.lastOpeningBracketAt,e);s.cb({tag:n,deleteFrom:n.leftOuterWhitespace,deleteTo:e,insert:l,rangesArr:i,proposedReturn:[n.leftOuterWhitespace,e,l]}),H(e,s,i),n={},o={}}if(n.lastOpeningBracketAt!==void 0&&n.onlyPlausible&&n.name&&!n.quotes&&(n.lastOpeningBracketAt=void 0,n.name=void 0,n.onlyPlausible=!1),(n.lastOpeningBracketAt===void 0||!n.onlyPlausible)&&!n.quotes&&(n.lastOpeningBracketAt=e,n.slashPresent=!1,n.attributes=[],V===null?n.leftOuterWhitespace=e:s.trimOnlySpaces&&V===0?n.leftOuterWhitespace=w||e:n.leftOuterWhitespace=V,`${t[e+1]}${t[e+2]}${t[e+3]}`=="!--"||`${t[e+1]}${t[e+2]}${t[e+3]}${t[e+4]}${t[e+5]}${t[e+6]}${t[e+7]}${t[e+8]}`=="![CDATA[")){let l=!0;t[e+2]==="-"&&(l=!1);let a;for(let r=e;r<h;r++)if((!a&&l&&`${t[r-2]}${t[r-1]}${t[r]}`=="]]>"||!l&&`${t[r-2]}${t[r-1]}${t[r]}`=="-->")&&(a=r),a&&(a<r&&t[r].trim()||t[r+1]===void 0)){let g=r;(t[r+1]===void 0&&!t[r].trim()||t[r]===">")&&(g+=1),(!b.length||b[b.length-1][0]!==n.lastOpeningBracketAt)&&b.push([n.lastOpeningBracketAt,a+1]),(!$.length||$[$.length-1][0]!==n.lastOpeningBracketAt)&&$.push([n.lastOpeningBracketAt,a+1]);let u=L(t,r,n.leftOuterWhitespace,g,n.lastOpeningBracketAt,a);s.cb({tag:n,deleteFrom:n.leftOuterWhitespace,deleteTo:g,insert:u,rangesArr:i,proposedReturn:[n.leftOuterWhitespace,g,u]}),e=r-1,t[r]===">"&&(e=r),n={},o={};break}}}!t[e].trim()||t[e].charCodeAt(0)===847?(V===null&&(V=e,n.lastOpeningBracketAt!==void 0&&n.lastOpeningBracketAt<e&&n.nameStarts&&n.nameStarts<n.lastOpeningBracketAt&&e===n.lastOpeningBracketAt+1&&!c.some(l=>l.name===n.name)&&(n.onlyPlausible=!0,n.name=void 0,n.nameStarts=void 0)),(t[e]===`
`||t[e]==="\r")&&(N=e,I&&(I=!1))):(V!==null&&(!n.quotes&&o.equalsAt>V-1&&o.nameEnds&&o.equalsAt>o.nameEnds&&t[e]!=='"'&&t[e]!=="'"&&(te(o)&&n.attributes.push(o),o={},n.equalsSpottedAt=void 0),V=null),I||(I=!0,F&&!C&&typeof N=="number"&&e&&N<e-1&&(t.slice(N+1,e).trim()?N=null:i.push([N+1,e])))),t[e]===" "?w===null&&(w=e):w!==null&&(w=null),n.name==="script"&&(C=!n.slashPresent)}if(t&&(s.trimOnlySpaces&&t[0]===" "||!s.trimOnlySpaces&&!t[0].trim()))for(let e=0;e<h;e++)if(s.trimOnlySpaces&&t[e]!==" "||!s.trimOnlySpaces&&t[e].trim()){i.push([0,e]);break}else t[e+1]||i.push([0,e+1]);if(t&&(s.trimOnlySpaces&&t[~-t.length]===" "||!s.trimOnlySpaces&&!t[~-t.length].trim())){for(let e=t.length;e--;)if(s.trimOnlySpaces&&t[e]!==" "||!s.trimOnlySpaces&&t[e].trim()){i.push([e+1,h]);break}}let O=i.current();if((!m||!m.cb)&&O){if(O[0]&&!O[0][0]){let e=O[0][1];i.ranges[0]=[i.ranges[0][0],i.ranges[0][1]]}if(O[O.length-1]&&O[O.length-1][1]===t.length){let e=O[O.length-1][0];if(i.ranges){let l=i.ranges[i.ranges.length-1][0];t[l-1]&&(s.trimOnlySpaces&&t[l-1]===" "||!s.trimOnlySpaces&&!t[l-1].trim())&&(l-=1);let a=i.ranges[i.ranges.length-1][2];i.ranges[i.ranges.length-1]=[l,i.ranges[i.ranges.length-1][1]],a?.trim()&&i.ranges[i.ranges.length-1].push(a.trimEnd())}}}return{log:{timeTakenInMilliseconds:Date.now()-D},result:me(t,i.current()),ranges:i.current(),allTagLocations:b,filteredTagLocations:$}}export{oe as defaults,be as stripHtml,Ne as version};
